Refactoring based on Martin Fowler's book.